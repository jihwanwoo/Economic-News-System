#!/bin/bash

# κ²½μ  λ‰΄μ¤ μλ™ μƒμ„± νμ΄ν”„λΌμΈ μ‹¤ν–‰ μ¤ν¬λ¦½νΈ

echo "π€ κ²½μ  λ‰΄μ¤ μλ™ μƒμ„± νμ΄ν”„λΌμΈ μ‹μ‘"
echo "=================================================="

# ν„μ¬ λ””λ ‰ν† λ¦¬ ν™•μΈ
if [ ! -f "run_full_pipeline.py" ]; then
    echo "β run_full_pipeline.py νμΌμ„ μ°Ύμ„ μ μ—†μµλ‹λ‹¤."
    echo "μ¬λ°”λ¥Έ λ””λ ‰ν† λ¦¬μ—μ„ μ‹¤ν–‰ν•΄μ£Όμ„Έμ”."
    exit 1
fi

# Python κ°€μƒν™κ²½ ν™•μΈ (μ„ νƒμ‚¬ν•­)
if [ -n "$VIRTUAL_ENV" ]; then
    echo "β… κ°€μƒν™κ²½ ν™μ„±ν™”λ¨: $VIRTUAL_ENV"
else
    echo "β οΈ κ°€μƒν™κ²½μ΄ ν™μ„±ν™”λμ§€ μ•μ•μµλ‹λ‹¤."
fi

# AWS μκ²©μ¦λ… ν™•μΈ
if aws sts get-caller-identity >/dev/null 2>&1; then
    echo "β… AWS μκ²©μ¦λ… ν™•μΈλ¨"
else
    echo "β AWS μκ²©μ¦λ…μ„ ν™•μΈν•  μ μ—†μµλ‹λ‹¤."
    echo "aws configureλ¥Ό μ‹¤ν–‰ν•μ—¬ μκ²©μ¦λ…μ„ μ„¤μ •ν•΄μ£Όμ„Έμ”."
    exit 1
fi

echo ""
echo "π“ νμ΄ν”„λΌμΈ μ‹¤ν–‰ μ¤‘..."
echo "=================================================="

# νμ΄ν”„λΌμΈ μ‹¤ν–‰
python run_full_pipeline.py "$@"

# μ‹¤ν–‰ κ²°κ³Ό ν™•μΈ
if [ $? -eq 0 ]; then
    echo ""
    echo "π‰ νμ΄ν”„λΌμΈ μ‹¤ν–‰ μ™„λ£!"
    echo "π“ κ²°κ³Ό νμΌμ€ output/ λ””λ ‰ν† λ¦¬μ—μ„ ν™•μΈν•μ„Έμ”."
    
    # μµμ‹  κ²°κ³Ό νμΌ ν‘μ‹
    if [ -d "output" ]; then
        echo ""
        echo "π“„ μƒμ„±λ νμΌ:"
        ls -la output/ | grep "$(date +%Y%m%d)" | tail -5
    fi
else
    echo ""
    echo "β νμ΄ν”„λΌμΈ μ‹¤ν–‰ μ‹¤ν¨"
    echo "λ΅κ·Έλ¥Ό ν™•μΈν•μ—¬ λ¬Έμ λ¥Ό ν•΄κ²°ν•΄μ£Όμ„Έμ”."
    exit 1
fi
